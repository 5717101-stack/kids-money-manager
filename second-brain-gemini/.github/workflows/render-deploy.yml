name: ðŸŒ Deploy to Render

# Render auto-deploys via its own GitHub webhook.
# This workflow only creates a git tag and logs a summary.
# The WhatsApp deployment notification is handled by startup_event()
# inside app/main.py â€” fired once when the server actually starts.

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  deploy:
    name: Deploy to Render
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    
    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v4
      
      - name: ðŸ“ Read version
        id: version
        run: |
          VERSION=$(cat VERSION | tr -d '[:space:]')
          echo "version=$VERSION" >> $GITHUB_OUTPUT
          echo "ðŸ“Œ Deploying version: $VERSION"
      
      # NOTE: No Render API trigger here â€” Render auto-deploys from GitHub webhook.
      # Triggering via API caused DOUBLE deploys and duplicate WhatsApp notifications.
      
      - name: ðŸ“Š Deployment Status
        run: |
          echo "## ðŸŒ Render Deployment" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Version:** ${{ steps.version.outputs.version }}" >> $GITHUB_STEP_SUMMARY
          echo "**Status:** Auto-deploy triggered via Render webhook" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ’¡ WhatsApp notification will be sent by the server's startup_event()" >> $GITHUB_STEP_SUMMARY
